<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Employé POSIT'IF - Travailler</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="newCascadeStyleSheet.css">
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    </head>
    <body>
        <div id="retour">
        <input type="button" value="Retour Menu" OnClick="javascript:location.href='MenuEmp.html'">
        </div>
        
        <div id = intro></div>
        
        <table style="width:100%">
            <tr>
                <th style="width:50%">
                    <table id="AttributClient">
                        <tr>
                            <th style="width:50%">
                                Attribut
                            </th>
                            <th style="width:50%">
                                Contenu
                            </th>
                        </tr>
                    </table>
                </th>
                <th style="width:50%">
                    <div id="Prediction"> 
                         <table style="width:100%">
                            <tr>
                                <th style="width:30%">
                                    <div id="Amour"> 
                                        <a> - </a>
                                        <input type="range" min="1" max="4" value="2" id="Range_Amour">
                                        <a> + </a>
                                    </div>
                                </th>
                                <th style="width:20%"> Amour </th>
                                <th style="width:50%">
                                    <div id="PredictionAmour"> 
                                        
                                    </div>
                                </th>
                            </tr>
                            <tr>
                                <th style="width:30%">
                                    <div id="Sante">
                                        <a>-</a>
                                        <input type="range" min="1" max="4" value="2" id="Range_Sante">
                                        <a>+</a>
                                    </div>
                                </th>
                                <th style="width:20%"> Santé </th>
                                <th style="width:50%">
                                    <div id="PredictionSante"> 
                                    </div>
                                </th>
                            </tr>
                            <tr>
                                <th style="width:30%">
                                    <div id="Travail">
                                        <a>-</a>
                                        <input type="range" min="1" max="4" value="2" id="Range_Travail">
                                        <a>+</a>
                                    </div>
                                </th>
                                <th style="width:20%"> Travail </th>
                                <th style="width:50%">
                                    <div id="PredictionTravail"> 
                                    </div>
                                </th>
                            </tr>
                        </table>
                            <input type="button" id ="bouton_predictions" value="Prédictions" style="width:100%; background-color:grey" onclick="predire()" >
                    </div>
                </th>
            </tr>
            <tr>
                <th style="width:50%">
                    <div id="demandeClient">zqfrdsqhgqdh  </div> 
                </th>
                <th style="width:50%">
                    <div id="InfoDetaille"> fdhdwjdwgtj</div>
                </th>
            </tr>
        </table>
        <table style="width:100%">
            <tr>
                <th style="width:85%">
                    <input style="width:100%" type="button" id ="bouton_commencer" value="Commencer" onclick="commencer()">
                </th>
                <th style="width:15%">
                    <input style="width:100%" type="button" id ="bouton_terminer" value="Terminer" onclick="terminer()" disabled >
                </th>
            </tr>
        </table>
        
        <script>
            
            
            function attributClient ()
            {
                $.ajax({
                    url: './ActionServlet',
                    method: 'POST',
                    data: {
                        action: 'demandeAttributClient'
                    },
                   dataType: 'json'
                }).done(function (data) {
                    var newLink = document.getElementById('AttributClient');
                    for (var iter = 0; iter < data.Conversation.listeProprieteClt.length; iter++) {
                        var row = document.createElement('tr');
                        var tup1 = document.createElement('td');
                        var tup2 = document.createElement('td');
                        var txt1 = document.createTextNode(data.Conversation.listeProprieteClt[iter].nom);
                        var txt2 = document.createTextNode(data.Conversation.listeProprieteClt[iter].valeur);
                        tup1.appendChild(txt1);
                        tup2.appendChild(txt2);
                        row.appendChild(tup1);
                        row.appendChild(tup2);
                        newLink.appendChild(row);
                    }
                    var introduction=data.Conversation.listeProprieteClt[3].valeur+". "+data.Conversation.listeProprieteClt[1].valeur+" "+data.Conversation.listeProprieteClt[2].valeur+" demande une voyance par "+data.Conversation.medium.nom+", "+data.Conversation.medium.Specialite;
                        var espaceIntro = document.getElementById('intro');
                         var par = document.createElement('p');
                        var stringIntro = document.createTextNode(introduction);
                        par.appendChild(stringIntro);
                        espaceIntro.appendChild(par);
                });
            }
            
            $(document).ready(function () {
               attributClient(); 
               document.getElementById("bouton_terminer").disabled = true;
            });
            
            var idAttente = setInterval(attenteConvTerminee(), 3000);
            
            function attenteConvTerminee()
            {
                $.ajax({
                    url: './ActionServlet',
                    method: 'POST',
                    data: {
                        action: 'conversationTerminee'
                    },
                   dataType: 'json'
                }).done(function (data) {
                    terminer ();
                }).fail(function(){
                    
                });
            }
            
            function commencer () {
                $.ajax({
                    url: './ActionServlet',
                    method: 'POST',
                    data: {
                        action: 'accepterVoyance'
                    },
                   dataType: 'json'
                }).done(function (data) {
                    document.getElementById("bouton_terminer").disabled = false;
                    document.getElementById("bouton_commencer").disabled = true;
                });
            }
            
            function promptCommentaire() {
                var commentaire = prompt("Veuillez laisser un commentaire pour facilier le suivi du client", "");
                
                $.ajax({
                    url: './ActionServlet',
                    method: 'POST',
                    data: {
                        action: 'commenterVoyance',
                        comment: commentaire
                    },
                   dataType: 'json'
                }).done(function () {
                    var newLink = document.getElementById('term');
                    var txt1 = document.createTextNode(data.personne.prenom);
                    newLink.appendChild(txt1);
                    document.getElementById("bouton_terminer").disabled = true;
                    document.getElementById("bouton-predictions").disabled = true;
                    document.getElementById("bouton_commencer").disabled = false;
                    $.ajax({
                        url: './ActionServlet',
                        method: 'POST',
                        data: {
                            action: 'terminerVoyance',
                            comment: commentaire
                        },
                       dataType: 'json'
                    });
                });
                
            }
            
            function terminer () {
                promptCommentaire();
                window:location="Travailler.html";
            }
            
            function predire() {
                var a=document.getElementById("Range_Amour").value;
                var b=document.getElementById("Range_Sante").value;
                var c=document.getElementById("Range_Travail").value;
                
                $.ajax({
                    url: './ActionServlet',
                    method: 'POST',
                    data: {
                        action: 'predire',
                        range_amour: a,
                        range_sante:b,
                        range_travail:c
                    },
                   dataType: 'json'
                }).done(function (data){
                    $('#PredictionAmour').html(data.liste_predictions.prediction_amour);
                    $('#PredictionSante').html(data.liste_predictions.prediction_sante);
                    $('#PredictionTravail').html(data.liste_predictions.prediction_travail);
                    
                });
            }

        </script>
        
        
    </body>
    
    
    
    
    
</html>
